import{av as O,c as x,aA as L,r as P,ag as S,Q as B,o as m,d as u,e as c,az as s,aH as o,ai as T,ay as D,f as A,ax as _,aF as h,aC as J,aD as V}from"./_plugin-vue_export-helper-17771205.js";import{m as $,C as q,b as I,D as E,p as F,I as H,P as R,d as j}from"./index-ec7f1cc8.js";/* empty css              *//* empty css              */import{B as z}from"./index-80a81a32.js";import{s as M}from"./SimpleHeader-194467f3.js";import{g as Q,a as U}from"./address-4b069d6f.js";import{c as G,p as K}from"./order-972c975a.js";import"./use-route-8af935f0.js";const W=i=>(J("data-v-2b30dae2"),i=i(),V(),i),X={class:"create-order"},Y={class:"address-wrap"},Z={class:"address"},ss={class:"good"},as={class:"good-img"},ts=["src"],es={class:"good-desc"},os={class:"good-title"},rs={class:"good-btn"},ds={class:"price"},cs={class:"pay-wrap"},ns={class:"price"},is=W(()=>s("span",null,"商品金额",-1)),ls={style:{width:"90%",margin:"0 auto",padding:"50px 0"}},ps={__name:"CreateOrder",setup(i){const l=x(),y=L(),a=P({cartList:[],address:{},showPay:!1,orderNo:"",cartItemIds:[]});S(()=>{f()});const f=async()=>{$({message:"加载中...",forbidClick:!0});const{addressId:e,cartItemIds:t}=y.query,d=JSON.parse(t||q("cartItemIds"));I("cartItemIds",JSON.stringify(d));const{data:n}=await E({cartItemIds:d.join(",")}),{data:p}=e?await Q(e):await U();if(!p){l.push({path:"/address"});return}a.cartList=n,a.address=p,F()},v=()=>{l.push({path:"/address",query:{cartItemIds:JSON.stringify(a.cartItemIds),from:"create-order"}})},w=()=>{I("cartItemIds","")},C=async()=>{const e={addressId:a.address.addressId,cartItemIds:a.cartList.map(d=>d.cartItemId)},{data:t}=await G(e);I("cartItemIds",""),a.orderNo=t,a.showPay=!0},N=()=>{l.push({path:"/order"})},g=async e=>{await K({orderNo:a.orderNo,payType:e}),j("支付成功"),setTimeout(()=>{l.push({path:"/order"})},2e3)},b=B(()=>{let e=0;return a.cartList.forEach(t=>{e+=t.goodsCount*t.sellingPrice}),e});return(e,t)=>{const d=H,n=z,p=R;return m(),u("div",X,[c(M,{name:"生成订单",onCallback:w}),s("div",Y,[s("div",{class:"name",onClick:v},[s("span",null,o(a.address.userName),1),s("span",null,o(a.address.userPhone),1)]),s("div",Z,o(a.address.provinceName)+" "+o(a.address.cityName)+" "+o(a.address.regionName)+" "+o(a.address.detailAddress),1),c(d,{class:"arrow",name:"arrow"})]),s("div",ss,[(m(!0),u(T,null,D(a.cartList,(r,k)=>(m(),u("div",{class:"good-item",key:k},[s("div",as,[s("img",{src:e.$filters.prefix(r.goodsCoverImg),alt:""},null,8,ts)]),s("div",es,[s("div",os,[s("span",null,o(r.goodsName),1),s("span",null,"x"+o(r.goodsCount),1)]),s("div",rs,[s("div",ds,"¥"+o(r.sellingPrice),1)])])]))),128))]),s("div",cs,[s("div",ns,[is,s("span",null,"¥"+o(A(b)),1)]),c(n,{onClick:C,class:"pay-btn",color:"#1baeae",type:"primary",block:""},{default:_(()=>[h("生成订单")]),_:1})]),c(p,{closeable:"","close-on-click-overlay":!1,show:a.showPay,"onUpdate:show":t[2]||(t[2]=r=>a.showPay=r),position:"bottom",style:{height:"30%"},onClose:N},{default:_(()=>[s("div",ls,[c(n,{style:{marginBottom:"10px"},color:"#1989fa",block:"",onClick:t[0]||(t[0]=r=>g(1))},{default:_(()=>[h("支付宝支付")]),_:1}),c(n,{color:"#4fc08d",block:"",onClick:t[1]||(t[1]=r=>g(2))},{default:_(()=>[h("微信支付")]),_:1})])]),_:1},8,["show"])])}}},ws=O(ps,[["__scopeId","data-v-2b30dae2"]]);export{ws as default};
