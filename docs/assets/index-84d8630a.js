import{U as V,aj as k,Y as M,Z as N,V as _,F as P,aR as B,J as $,aS as Y,ag as I,ad as w,e as l,a as y,u as R,ao as X,a0 as C,X as j,r as G,aT as J,ac as Z}from"./_plugin-vue_export-helper-17771205.js";import{u as q,L as U,f as z}from"./index-ec7f1cc8.js";import{u as K}from"./index-ecf56c7f.js";const[O,m,Q]=V("list"),W={error:Boolean,offset:k(300),loading:Boolean,disabled:Boolean,finished:Boolean,errorText:String,direction:M("down"),loadingText:String,finishedText:String,immediateCheck:N};var p=_({name:O,props:W,emits:["load","update:error","update:loading"],setup(e,{emit:d,slots:i}){const r=P(e.loading),f=P(),v=P(),h=K(),a=B(f),o=()=>{y(()=>{if(r.value||e.finished||e.disabled||e.error||(h==null?void 0:h.value)===!1)return;const{offset:n,direction:g}=e,u=R(a);if(!u.height||X(f))return;let T=!1;const D=R(v);g==="up"?T=u.top-D.top<=n:T=D.bottom-u.bottom<=n,T&&(r.value=!0,d("update:loading",!0),d("load"))})},H=()=>{if(e.finished){const n=i.finished?i.finished():e.finishedText;if(n)return l("div",{class:m("finished-text")},[n])}},x=()=>{d("update:error",!1),o()},E=()=>{if(e.error){const n=i.error?i.error():e.errorText;if(n)return l("div",{role:"button",class:m("error-text"),tabindex:0,onClick:x},[n])}},c=()=>{if(r.value&&!e.finished&&!e.disabled)return l("div",{class:m("loading")},[i.loading?i.loading():l(U,{class:m("loading-icon")},{default:()=>[e.loadingText||Q("loading")]})])};return $(()=>[e.loading,e.finished,e.error],o),h&&$(h,n=>{n&&o()}),Y(()=>{r.value=e.loading}),I(()=>{e.immediateCheck&&o()}),q({check:o}),w("scroll",o,{target:a,passive:!0}),()=>{var n;const g=(n=i.default)==null?void 0:n.call(i),u=l("div",{ref:v,class:m("placeholder")},null);return l("div",{ref:f,role:"feed",class:m(),"aria-busy":r.value},[e.direction==="down"?g:u,c(),H(),E(),e.direction==="up"?g:u])}}});const le=C(p),[ee,b,te]=V("pull-refresh"),A=50,ae=["pulling","loosing","success"],ne={disabled:Boolean,modelValue:Boolean,headHeight:k(A),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:j,successDuration:k(500),animationDuration:k(300)};var se=_({name:ee,props:ne,emits:["change","refresh","update:modelValue"],setup(e,{emit:d,slots:i}){let r;const f=P(),v=P(),h=B(f),a=G({status:"normal",distance:0,duration:0}),o=z(),H=()=>{if(e.headHeight!==A)return{height:`${e.headHeight}px`}},x=()=>a.status!=="loading"&&a.status!=="success"&&!e.disabled,E=t=>{const s=+(e.pullDistance||e.headHeight);return t>s&&(t<s*2?t=s+(t-s)/2:t=s*1.5+(t-s*2)/4),Math.round(t)},c=(t,s)=>{const S=+(e.pullDistance||e.headHeight);a.distance=t,s?a.status="loading":t===0?a.status="normal":t<S?a.status="pulling":a.status="loosing",d("change",{status:a.status,distance:t})},n=()=>{const{status:t}=a;return t==="normal"?"":e[`${t}Text`]||te(t)},g=()=>{const{status:t,distance:s}=a;if(i[t])return i[t]({distance:s});const S=[];return ae.includes(t)&&S.push(l("div",{class:b("text")},[n()])),t==="loading"&&S.push(l(U,{class:b("loading")},{default:n})),S},u=()=>{a.status="success",setTimeout(()=>{c(0)},+e.successDuration)},T=t=>{r=J(h.value)===0,r&&(a.duration=0,o.start(t))},D=t=>{x()&&T(t)},F=t=>{if(x()){r||T(t);const{deltaY:s}=o;o.move(t),r&&s.value>=0&&o.isVertical()&&(Z(t),c(E(s.value)))}},L=()=>{r&&o.deltaY.value&&x()&&(a.duration=+e.animationDuration,a.status==="loosing"?(c(+e.headHeight,!0),d("update:modelValue",!0),y(()=>d("refresh"))):c(0))};return $(()=>e.modelValue,t=>{a.duration=+e.animationDuration,t?c(+e.headHeight,!0):i.success||e.successText?u():c(0,!1)}),w("touchmove",F,{target:v}),()=>{var t;const s={transitionDuration:`${a.duration}ms`,transform:a.distance?`translate3d(0,${a.distance}px, 0)`:""};return l("div",{ref:f,class:b()},[l("div",{ref:v,class:b("track"),style:s,onTouchstartPassive:D,onTouchend:L,onTouchcancel:L},[l("div",{class:b("head"),style:H()},[g()]),(t=i.default)==null?void 0:t.call(i)])])}}});const ce=C(se);export{le as L,ce as P};
