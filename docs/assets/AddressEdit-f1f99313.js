import{U as A,_ as Me,T as P,aq as ie,V as R,X as F,aY as q,b0 as Y,F as O,ar as xe,a6 as Fe,ad as Te,e as u,ac as _e,ak as we,aj as H,Z as ce,Y as Le,Q as p,aX as He,J as U,b4 as ee,a as De,au as X,a8 as Se,a0 as Q,b1 as Ue,aa as te,W as je,ai as Ye,b5 as ze,r as ke,b as Ke,af as ae,aA as qe,c as Ge,ag as Je,o as Xe,d as Qe}from"./_plugin-vue_export-helper-17771205.js";import{f as We,u as W,H as me,L as Oe,E as Ze,l as ne,P as et,G as re,J as G}from"./index-ec7f1cc8.js";import{C as pe}from"./index-43bf36ba.js";import{F as J}from"./index-7dec7c79.js";/* empty css              */import{B as fe}from"./index-80a81a32.js";/* empty css              *//* empty css              */import{a as tt,T as at}from"./index-ecf56c7f.js";import{s as nt}from"./SimpleHeader-194467f3.js";import{g as lt,c as ot,E as st,D as it}from"./address-4b069d6f.js";import{F as ct}from"./index-4e1dab2c.js";import"./use-route-8af935f0.js";import"./use-id-a3948fe8.js";const[rt,V,ve]=A("picker"),Ee=e=>e.find(t=>!t.disabled)||e[0];function ut(e,t){const a=e[0];if(a){if(Array.isArray(a))return"multiple";if(t.children in a)return"cascade"}return"default"}function ue(e,t){t=ie(t,0,e.length);for(let a=t;a<e.length;a++)if(!e[a].disabled)return a;for(let a=t-1;a>=0;a--)if(!e[a].disabled)return a;return 0}const he=(e,t,a)=>t!==void 0&&!!e.find(n=>n[a.value]===t);function de(e,t,a){const n=e.findIndex(h=>h[a.value]===t),l=ue(e,n);return e[l]}function dt(e,t,a){const n=[];let l={[t.children]:e},h=0;for(;l&&l[t.children];){const i=l[t.children],m=a.value[h];if(l=Me(m)?de(i,m,t):void 0,!l&&i.length){const v=Ee(i)[t.value];l=de(i,v,t)}h++,n.push(i)}return n}function mt(e){const{transform:t}=window.getComputedStyle(e),a=t.slice(7,t.length-1).split(", ")[5];return Number(a)}function ft(e){return P({text:"text",value:"value",children:"children"},e)}const ge=200,be=300,vt=15,[Be,le]=A("picker-column"),Ve=Symbol(Be);var ht=R({name:Be,props:{value:F,fields:q(Object),options:Y(),readonly:Boolean,allowHtml:Boolean,optionHeight:q(Number),swipeDuration:q(F),visibleOptionNum:q(F)},emits:["change","clickOption"],setup(e,{emit:t,slots:a}){let n,l,h,i,m;const v=O(),o=O(),r=O(0),b=O(0),c=We(),y=()=>e.options.length,w=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,D=g=>{const x=ue(e.options,g),s=-x*e.optionHeight,d=()=>{const _=e.options[x][e.fields.value];_!==e.value&&t("change",_)};n&&s!==r.value?m=d:d(),r.value=s},k=()=>e.readonly||!e.options.length,$=g=>{n||k()||(m=null,b.value=ge,D(g),t("clickOption",e.options[g]))},I=g=>ie(Math.round(-g/e.optionHeight),0,y()-1),B=(g,x)=>{const s=Math.abs(g/x);g=r.value+s/.003*(g<0?-1:1);const d=I(g);b.value=+e.swipeDuration,D(d)},M=()=>{n=!1,b.value=0,m&&(m(),m=null)},f=g=>{if(!k()){if(c.start(g),n){const x=mt(o.value);r.value=Math.min(0,x-w())}b.value=0,l=r.value,h=Date.now(),i=l,m=null}},T=g=>{if(k())return;c.move(g),c.isVertical()&&(n=!0,_e(g,!0)),r.value=ie(l+c.deltaY.value,-(y()*e.optionHeight),e.optionHeight);const x=Date.now();x-h>be&&(h=x,i=r.value)},C=()=>{if(k())return;const g=r.value-i,x=Date.now()-h;if(x<be&&Math.abs(g)>vt){B(g,x);return}const d=I(r.value);b.value=ge,D(d),setTimeout(()=>{n=!1},0)},E=()=>{const g={height:`${e.optionHeight}px`};return e.options.map((x,s)=>{const d=x[e.fields.text],{disabled:_}=x,K=x[e.fields.value],z={role:"button",style:g,tabindex:_?-1:0,class:[le("item",{disabled:_,selected:K===e.value}),x.className],onClick:()=>$(s)},$e={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:d};return u("li",z,[a.option?a.option(x):u("div",$e,null)])})};return xe(Ve),W({stopMomentum:M}),Fe(()=>{const g=e.options.findIndex(d=>d[e.fields.value]===e.value),s=-ue(e.options,g)*e.optionHeight;r.value=s}),Te("touchmove",T,{target:v}),()=>u("div",{ref:v,class:le(),onTouchstartPassive:f,onTouchend:C,onTouchcancel:C},[u("ul",{ref:o,style:{transform:`translate3d(0, ${r.value+w()}px, 0)`,transitionDuration:`${b.value}ms`,transitionProperty:b.value?"all":"none"},class:le("wrapper"),onTransitionend:M},[E()])])}});const[gt]=A("picker-toolbar"),Z={title:String,cancelButtonText:String,confirmButtonText:String},bt=["cancel","confirm","title","toolbar"],yt=Object.keys(Z);var Pe=R({name:gt,props:Z,emits:["confirm","cancel"],setup(e,{emit:t,slots:a}){const n=()=>{if(a.title)return a.title();if(e.title)return u("div",{class:[V("title"),"van-ellipsis"]},[e.title])},l=()=>t("cancel"),h=()=>t("confirm"),i=()=>{const v=e.cancelButtonText||ve("cancel");return u("button",{type:"button",class:[V("cancel"),me],onClick:l},[a.cancel?a.cancel():v])},m=()=>{const v=e.confirmButtonText||ve("confirm");return u("button",{type:"button",class:[V("confirm"),me],onClick:h},[a.confirm?a.confirm():v])};return()=>u("div",{class:V("toolbar")},[a.toolbar?a.toolbar():[i(),n(),m()]])}});const[Ae,oe]=A("picker-group"),Ie=Symbol(Ae),Ct=P({tabs:Y(),nextStepText:String},Z);R({name:Ae,props:Ct,emits:["confirm","cancel"],setup(e,{emit:t,slots:a}){const n=O(0),{children:l,linkChildren:h}=we(Ie);h();const i=()=>n.value<e.tabs.length-1&&e.nextStepText,m=()=>{i()?n.value++:t("confirm",l.map(o=>o.confirm()))},v=()=>t("cancel");return()=>{var o;const r=(o=a.default)==null?void 0:o.call(a),b=i()?e.nextStepText:e.confirmButtonText;return u("div",{class:oe()},[u(Pe,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:b,onConfirm:m,onCancel:v},null),u(tt,{active:n.value,"onUpdate:active":c=>n.value=c,class:oe("tabs"),shrink:!0,animated:!0},{default:()=>[e.tabs.map((c,y)=>u(at,{title:c,titleClass:oe("tab-title")},{default:()=>[r==null?void 0:r[y]]}))]})])}}});const Ne=P({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:H(44),showToolbar:ce,swipeDuration:H(1e3),visibleOptionNum:H(6)},Z),xt=P({},Ne,{columns:Y(),modelValue:Y(),toolbarPosition:Le("top"),columnsFieldNames:Object});var Tt=R({name:rt,props:xt,emits:["confirm","cancel","change","clickOption","update:modelValue"],setup(e,{emit:t,slots:a}){const n=O(),l=O(e.modelValue.slice(0)),{parent:h}=xe(Ie),{children:i,linkChildren:m}=we(Ve);m();const v=p(()=>ft(e.columnsFieldNames)),o=p(()=>He(e.optionHeight)),r=p(()=>ut(e.columns,v.value)),b=p(()=>{const{columns:s}=e;switch(r.value){case"multiple":return s;case"cascade":return dt(s,v.value,l);default:return[s]}}),c=p(()=>b.value.some(s=>s.length)),y=p(()=>b.value.map((s,d)=>de(s,l.value[d],v.value))),w=p(()=>b.value.map((s,d)=>s.findIndex(_=>_[v.value.value]===l.value[d]))),D=(s,d)=>{if(l.value[s]!==d){const _=l.value.slice(0);_[s]=d,l.value=_}},k=()=>({selectedValues:l.value.slice(0),selectedOptions:y.value,selectedIndexes:w.value}),$=(s,d)=>{D(d,s),r.value==="cascade"&&l.value.forEach((_,K)=>{const z=b.value[K];he(z,_,v.value)||D(K,z.length?z[0][v.value.value]:void 0)}),t("change",P({columnIndex:d},k()))},I=(s,d)=>t("clickOption",P({columnIndex:d,currentOption:s},k())),B=()=>{i.forEach(d=>d.stopMomentum());const s=k();return De(()=>{t("confirm",s)}),s},M=()=>t("cancel",k()),f=()=>b.value.map((s,d)=>u(ht,{value:l.value[d],fields:v.value,options:s,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:o.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:_=>$(_,d),onClickOption:_=>I(_,d)},{option:a.option})),T=s=>{if(c.value){const d={height:`${o.value}px`},_={backgroundSize:`100% ${(s-o.value)/2}px`};return[u("div",{class:V("mask"),style:_},null),u("div",{class:[Ze,V("frame")],style:d},null)]}},C=()=>{const s=o.value*+e.visibleOptionNum,d={height:`${s}px`};return u("div",{ref:n,class:V("columns"),style:d},[f(),T(s)])},E=()=>{if(e.showToolbar&&!h)return u(Pe,Se(X(e,yt),{onConfirm:B,onCancel:M}),X(a,bt))};U(b,s=>{s.forEach((d,_)=>{d.length&&!he(d,l.value[_],v.value)&&D(_,Ee(d)[v.value.value])})},{immediate:!0});let g;return U(()=>e.modelValue,s=>{!ee(s,l.value)&&!ee(s,g)&&(l.value=s.slice(0))},{deep:!0}),U(l,s=>{ee(s,e.modelValue)||(g=s.slice(0),t("update:modelValue",g))},{immediate:!0}),Te("touchmove",_e,{target:n}),W({confirm:B,getSelectedOptions:()=>y.value}),()=>{var s,d;return u("div",{class:V()},[e.toolbarPosition==="top"?E():null,e.loading?u(Oe,{class:V("loading")},null):null,(s=a["columns-top"])==null?void 0:s.call(a),C(),(d=a["columns-bottom"])==null?void 0:d.call(a),e.toolbarPosition==="bottom"?E():null])}}});const j="000000",_t=["title","cancel","confirm","toolbar","columns-top","columns-bottom"],wt=["title","loading","readonly","optionHeight","swipeDuration","visibleOptionNum","cancelButtonText","confirmButtonText"],N=(e="",t=j,a=void 0)=>({text:e,value:t,children:a});function Dt({areaList:e,columnsNum:t,columnsPlaceholder:a}){const{city_list:n={},county_list:l={},province_list:h={}}=e,i=t>1,m=t>2,v=()=>{if(i)return a.length?[N(a[0],j,m?[]:void 0)]:[]},o=new Map;Object.keys(h).forEach(c=>{o.set(c.slice(0,2),N(h[c],c,v()))});const r=new Map;if(i){const c=()=>{if(m)return a.length?[N(a[1])]:[]};Object.keys(n).forEach(y=>{const w=N(n[y],y,c());r.set(y.slice(0,4),w);const D=o.get(y.slice(0,2));D&&D.children.push(w)})}m&&Object.keys(l).forEach(c=>{const y=r.get(c.slice(0,4));y&&y.children.push(N(l[c],c))});const b=Array.from(o.values());if(a.length){const c=m?[N(a[2])]:void 0,y=i?[N(a[1],j,c)]:void 0;b.unshift(N(a[0],j,y))}return b}const St=Q(Tt),[kt,Ot]=A("area"),pt=P({},Ne,{modelValue:String,columnsNum:H(3),columnsPlaceholder:Y(),areaList:{type:Object,default:()=>({})}});var Et=R({name:kt,props:pt,emits:["change","confirm","cancel","update:modelValue"],setup(e,{emit:t,slots:a}){const n=O([]),l=O(),h=p(()=>Dt(e)),i=(...o)=>t("change",...o),m=(...o)=>t("cancel",...o),v=(...o)=>t("confirm",...o);return U(n,o=>{const r=o.length?o[o.length-1]:"";r&&r!==e.modelValue&&t("update:modelValue",r)},{deep:!0}),U(()=>e.modelValue,o=>{if(o){const r=n.value.length?n.value[n.value.length-1]:"";o!==r&&(n.value=[`${o.slice(0,2)}0000`,`${o.slice(0,4)}00`,o].slice(0,+e.columnsNum))}else n.value=[]},{immediate:!0}),W({confirm:()=>{var o;return(o=l.value)==null?void 0:o.confirm()},getSelectedOptions:()=>{var o;return((o=l.value)==null?void 0:o.getSelectedOptions())||[]}}),()=>u(St,Se({ref:l,modelValue:n.value,"onUpdate:modelValue":o=>n.value=o,class:Ot(),columns:h.value,onChange:i,onCancel:m,onConfirm:v},X(e,wt)),X(a,_t))}});const Bt=Q(Et),[Vt,se]=A("switch"),Pt={size:F,loading:Boolean,disabled:Boolean,modelValue:te,activeColor:String,inactiveColor:String,activeValue:{type:te,default:!0},inactiveValue:{type:te,default:!1}};var At=R({name:Vt,props:Pt,emits:["change","update:modelValue"],setup(e,{emit:t,slots:a}){const n=()=>e.modelValue===e.activeValue,l=()=>{if(!e.disabled&&!e.loading){const i=n()?e.inactiveValue:e.activeValue;t("update:modelValue",i),t("change",i)}},h=()=>{if(e.loading){const i=n()?e.activeColor:e.inactiveColor;return u(Oe,{class:se("loading"),color:i},null)}if(a.node)return a.node()};return Ue(()=>e.modelValue),()=>{var i;const{size:m,loading:v,disabled:o,activeColor:r,inactiveColor:b}=e,c=n(),y={fontSize:je(m),backgroundColor:c?r:b};return u("div",{role:"switch",class:se({on:c,loading:v,disabled:o}),style:y,tabindex:o?void 0:0,"aria-checked":c,onClick:l},[u("div",{class:se("node")},[h()]),(i=a.background)==null?void 0:i.call(a)])}}});const It=Q(At),[Nt,ye]=A("address-edit-detail"),Ce=A("address-edit")[2];var Rt=R({name:Nt,props:{show:Boolean,rows:F,value:String,rules:Array,focused:Boolean,maxlength:F,searchResult:Array,showSearchResult:Boolean},emits:["blur","focus","input","selectSearch"],setup(e,{emit:t}){const a=O(),n=()=>e.focused&&e.searchResult&&e.showSearchResult,l=o=>{t("selectSearch",o),t("input",`${o.address||""} ${o.name||""}`.trim())},h=()=>{if(!n())return;const{searchResult:o}=e;return o.map(r=>u(pe,{clickable:!0,key:(r.name||"")+(r.address||""),icon:"location-o",title:r.name,label:r.address,class:ye("search-item"),border:!1,onClick:()=>l(r)},null))},i=o=>t("blur",o),m=o=>t("focus",o),v=o=>t("input",o);return()=>{if(e.show)return u(Ye,null,[u(J,{autosize:!0,clearable:!0,ref:a,class:ye(),rows:e.rows,type:"textarea",rules:e.rules,label:Ce("addressDetail"),border:!n(),maxlength:e.maxlength,modelValue:e.value,placeholder:Ce("addressDetail"),onBlur:i,onFocus:m,"onUpdate:modelValue":v},null),h()])}}});const[$t,L,S]=A("address-edit"),Re={name:"",tel:"",city:"",county:"",country:"",province:"",areaCode:"",isDefault:!1,addressDetail:""},Mt={areaList:Object,isSaving:Boolean,isDeleting:Boolean,validator:Function,showArea:ce,showDetail:ce,showDelete:Boolean,disableArea:Boolean,searchResult:Array,telMaxlength:F,showSetDefault:Boolean,saveButtonText:String,areaPlaceholder:String,deleteButtonText:String,showSearchResult:Boolean,detailRows:H(1),detailMaxlength:H(200),areaColumnsPlaceholder:Y(),addressInfo:{type:Object,default:()=>P({},Re)},telValidator:{type:Function,default:ze}};var Ft=R({name:$t,props:Mt,emits:["save","focus","delete","clickArea","changeArea","changeDetail","selectSearch","changeDefault"],setup(e,{emit:t,slots:a}){const n=O(),l=ke({}),h=O(!1),i=O(!1),m=p(()=>Ke(e.areaList)&&Object.keys(e.areaList).length),v=p(()=>{const{province:f,city:T,county:C,areaCode:E}=l;if(E){const g=[f,T,C];return f&&f===T&&g.splice(1,1),g.filter(Boolean).join("/")}return""}),o=p(()=>{var f;return((f=e.searchResult)==null?void 0:f.length)&&i.value}),r=f=>{i.value=f==="addressDetail",t("focus",f)},b=p(()=>{const{validator:f,telValidator:T}=e,C=(E,g)=>({validator:x=>{if(f){const s=f(E,x);if(s)return s}return x?!0:g}});return{name:[C("name",S("nameEmpty"))],tel:[C("tel",S("telInvalid")),{validator:T,message:S("telInvalid")}],areaCode:[C("areaCode",S("areaEmpty"))],addressDetail:[C("addressDetail",S("addressEmpty"))]}}),c=()=>t("save",l),y=f=>{l.addressDetail=f,t("changeDetail",f)},w=f=>{l.province=f[0].text,l.city=f[1].text,l.county=f[2].text},D=({selectedValues:f,selectedOptions:T})=>{f.some(C=>C===j)?re(S("areaEmpty")):(h.value=!1,w(T),t("changeArea",T))},k=()=>t("delete",l),$=f=>{l.areaCode=f||""},I=()=>{setTimeout(()=>{i.value=!1})},B=f=>{l.addressDetail=f},M=()=>{if(e.showSetDefault){const f={"right-icon":()=>u(It,{modelValue:l.isDefault,"onUpdate:modelValue":T=>l.isDefault=T,onChange:T=>t("changeDefault",T)},null)};return ae(u(pe,{center:!0,title:S("defaultAddress"),class:L("default")},f),[[ne,!o.value]])}};return W({setAreaCode:$,setAddressDetail:B}),U(()=>e.addressInfo,f=>{P(l,Re,f),De(()=>{var T;const C=(T=n.value)==null?void 0:T.getSelectedOptions();C&&C.every(E=>E&&E.value!==j)&&w(C)})},{deep:!0,immediate:!0}),()=>{const{disableArea:f}=e;return u(ct,{class:L(),onSubmit:c},{default:()=>{var T;return[u("div",{class:L("fields")},[u(J,{modelValue:l.name,"onUpdate:modelValue":C=>l.name=C,clearable:!0,label:S("name"),rules:b.value.name,placeholder:S("name"),onFocus:()=>r("name")},null),u(J,{modelValue:l.tel,"onUpdate:modelValue":C=>l.tel=C,clearable:!0,type:"tel",label:S("tel"),rules:b.value.tel,maxlength:e.telMaxlength,placeholder:S("tel"),onFocus:()=>r("tel")},null),ae(u(J,{readonly:!0,label:S("area"),"is-link":!f,modelValue:v.value,rules:b.value.areaCode,placeholder:e.areaPlaceholder||S("area"),onFocus:()=>r("areaCode"),onClick:()=>{t("clickArea"),h.value=!f}},null),[[ne,e.showArea]]),u(Rt,{show:e.showDetail,rows:e.detailRows,rules:b.value.addressDetail,value:l.addressDetail,focused:i.value,maxlength:e.detailMaxlength,searchResult:e.searchResult,showSearchResult:e.showSearchResult,onBlur:I,onFocus:()=>r("addressDetail"),onInput:y,onSelectSearch:C=>t("selectSearch",C)},null),(T=a.default)==null?void 0:T.call(a)]),M(),ae(u("div",{class:L("buttons")},[u(fe,{block:!0,round:!0,type:"primary",text:e.saveButtonText||S("save"),class:L("button"),loading:e.isSaving,nativeType:"submit"},null),e.showDelete&&u(fe,{block:!0,round:!0,class:L("button"),loading:e.isDeleting,text:e.deleteButtonText||S("delete"),onClick:k},null)]),[[ne,!o.value]]),u(et,{show:h.value,"onUpdate:show":C=>h.value=C,round:!0,teleport:"body",position:"bottom",lazyRender:!1},{default:()=>[u(Bt,{modelValue:l.areaCode,"onUpdate:modelValue":C=>l.areaCode=C,ref:n,loading:!m.value,areaList:e.areaList,columnsPlaceholder:e.areaColumnsPlaceholder,onConfirm:D,onCancel:()=>{h.value=!1}},null)]})]}})}}});const Lt=Q(Ft);const Ht={class:"address-edit-box"},aa={__name:"AddressEdit",setup(e){const t=qe(),a=Ge(),n=ke({areaList:{province_list:{},city_list:{},county_list:{}},searchResult:[],type:"add",addressId:"",addressInfo:{},from:t.query.from});Je(async()=>{let i={},m={},v={};G.getLev1().forEach(c=>{i[c.id]=c.text,G.getLev2(c.id).forEach(y=>{m[y.id]=y.text,G.getLev3(y.id).forEach(w=>v[w.id]=w.text)})}),n.areaList.province_list=i,n.areaList.city_list=m,n.areaList.county_list=v;const{addressId:o,type:r,from:b}=t.query;if(n.addressId=o,n.type=r,n.from=b||"",r=="edit"){const{data:c}=await lt(o);let y="";const w=G.getLev1();Object.entries(n.areaList.county_list).forEach(([D,k])=>{if(k==c.regionName){const $=w.findIndex(B=>B.id.substr(0,2)==D.substr(0,2)),I=Object.entries(n.areaList.city_list).filter(([B,M])=>B.substr(0,4)==D.substr(0,4))[0];w[$].text==c.provinceName&&I[1]==c.cityName&&(y=D)}}),n.addressInfo={id:c.addressId,name:c.userName,tel:c.userPhone,province:c.provinceName,city:c.cityName,county:c.regionName,addressDetail:c.detailAddress,areaCode:y,isDefault:!!c.defaultFlag}}});const l=async i=>{const m={userName:i.name,userPhone:i.tel,provinceName:i.province,cityName:i.city,regionName:i.county,detailAddress:i.addressDetail,defaultFlag:i.isDefault?1:0};n.type=="edit"&&(m.addressId=n.addressId),await n.type=="add"?ot(m):st(m),re("保存成功"),setTimeout(()=>{a.back()},1e3)},h=async()=>{await it(n.addressId),re("删除成功"),setTimeout(()=>{a.back()},1e3)};return(i,m)=>{const v=Lt;return Xe(),Qe("div",Ht,[u(nt,{name:`${n.type=="add"?"新增地址":"编辑地址"}`},null,8,["name"]),u(v,{class:"edit","area-list":n.areaList,"address-info":n.addressInfo,"show-delete":n.type=="edit","show-set-default":"","show-search-result":"","search-result":n.searchResult,"area-columns-placeholder":["请选择","请选择","请选择"],onSave:l,onDelete:h},null,8,["area-list","address-info","show-delete","search-result"])])}}};export{aa as default};
